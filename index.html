<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financeiro</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; }
        body { margin: 0; background: #000; }
        .card { 
            background: rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(20px); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            transition: all 0.3s; 
        }
        .card:hover { background: rgba(255, 255, 255, 0.08); transform: translateY(-2px); }
        .btn { background: #007AFF; transition: all 0.2s; }
        .btn:hover { background: #0051D5; transform: scale(1.02); }
        .input { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); }
        .input:focus { background: rgba(255, 255, 255, 0.08); border-color: #007AFF; outline: 0; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [tab, setTab] = useState('dashboard');
            const [menu, setMenu] = useState(false);
            const [filter, setFilter] = useState('todos');
            const [data, setData] = useState({
                users: [
                    { id: 1, nome: 'Você', cor: '#007AFF' },
                    { id: 2, nome: 'Esposa', cor: '#FF2D55' }
                ],
                salaries: [
                    { id: 1, usuarioId: 1, valor: 5000, descricao: 'Salário Principal' },
                    { id: 2, usuarioId: 2, valor: 4000, descricao: 'Salário Esposa' }
                ],
                exp: [
                    { id: 1, descricao: 'Mercado', valor: 450, usuarioId: 1, data: '2025-09-27' },
                    { id: 2, descricao: 'Curso', valor: 197, usuarioId: 1, data: '2025-09-14' }
                ],
                subs: [
                    { id: 1, nome: 'Netflix', valor: 55.90, ativa: true },
                    { id: 2, nome: 'Spotify', valor: 21.90, ativa: true }
                ],
                bills: [
                    { id: 1, nome: 'Aluguel', valor: 1200 },
                    { id: 2, nome: 'Luz', valor: 180 },
                    { id: 3, nome: 'Água', valor: 80 }
                ],
                cards: [
                    { id: 1, nome: 'Nubank', limite: 5000, gasto: 1200, usuarioId: 1 },
                    { id: 2, nome: 'Inter', limite: 3000, gasto: 450, usuarioId: 2 }
                ],
                goals: [{ id: 1, nome: 'Viagem Disney', valorAlvo: 20000, valorAtual: 5000, cor: '#FF9500' }],
                budgets: [{ id: 1, categoria: 'Mercado', limite: 1000 }, { id: 2, categoria: 'Lazer', limite: 500 }],
                investments: [{ id: 1, nome: 'Tesouro Direto', valor: 23000, tipo: 'Renda Fixa', rendimento: 0.8 }],
                assets: [{ id: 1, nome: 'Apartamento', valor: 395000, tipo: 'Imóvel' }],
                debts: [{ id: 1, nome: 'Financiamento Imóvel', valorTotal: 280000, valorPago: 80000, parcelas: 360, parcelasPagas: 82 }],
                loans: [{ id: 1, nome: 'João', valor: 500, tipo: 'emprestei', data: '2025-09-01', pago: false }],
                tools: [
                    { id: 1, ferramenta: 'Claude Code', valor: 120, ativa: true },
                    { id: 2, ferramenta: 'Cursor', valor: 120, ativa: true },
                    { id: 3, ferramenta: 'Lovable', valor: 113, ativa: true },
                    { id: 4, ferramenta: 'Supabase', valor: 25, ativa: true }
                ]
            });

            const [modal, setModal] = useState(null);
            const [editing, setEditing] = useState(null);
            const [form, setForm] = useState({});

            useEffect(() => {
                const d = localStorage.getItem('finData');
                if (d) {
                    try { setData(JSON.parse(d)); } catch (e) { }
                }
            }, []);

            useEffect(() => {
                localStorage.setItem('finData', JSON.stringify(data));
            }, [data]);

            const fmt = (v) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(v);

            const income = data.salaries.reduce((a, s) => a + s.valor, 0);
            const expTotal = data.exp.reduce((a, e) => a + e.valor, 0);
            const subsTotal = data.subs.filter(s => s.ativa).reduce((a, s) => a + s.valor, 0);
            const billsTotal = data.bills.reduce((a, b) => a + b.valor, 0);
            const toolsTotal = data.tools.filter(t => t.ativa).reduce((a, t) => a + t.valor, 0);
            const investTotal = data.investments.reduce((a, i) => a + i.valor, 0);
            const assetsTotal = data.assets.reduce((a, as) => a + as.valor, 0);
            const debtsTotal = data.debts.reduce((a, d) => a + (d.valorTotal - d.valorPago), 0);
            const spent = expTotal + subsTotal + billsTotal + toolsTotal;
            const balance = income - spent;
            const netWorth = assetsTotal + investTotal - debtsTotal;
            const filtered = filter === 'todos' ? data.exp : data.exp.filter(e => e.usuarioId === parseInt(filter));

            const open = (type, item) => { setModal(type); setEditing(item); setForm(item || {}); };
            const close = () => { setModal(null); setEditing(null); setForm({}); };

            const save = () => {
                if (!form.nome && !form.descricao && !form.ferramenta && !form.categoria) return alert('Preencha os campos');
                const id = editing?.id || Date.now();
                const item = { id, ...form };
                const keyMap = { exp: 'exp', sub: 'subs', bill: 'bills', card: 'cards', goal: 'goals', budget: 'budgets', invest: 'investments', asset: 'assets', debt: 'debts', loan: 'loans', tool: 'tools', user: 'users', salary: 'salaries' };
                const key = keyMap[modal];
                const list = data[key];
                setData({ ...data, [key]: editing ? list.map(i => i.id === id ? item : i) : [...list, item] });
                close();
            };

            const del = (key, id) => {
                if (confirm('Excluir?')) setData({ ...data, [key]: data[key].filter(i => i.id !== id) });
            };

            const menus = ['dashboard', 'gastos', 'assinaturas', 'contas', 'cartoes', 'metas', 'orcamentos', 'ia', 'investimentos', 'patrimonio', 'dividas', 'emprestimos', 'usuarios'];

            return (
                <div className="min-h-screen bg-black text-white">
                    <div className="flex h-screen">
                        <aside className="hidden lg:flex flex-col w-64 bg-zinc-900 border-r border-zinc-800">
                            <div className="p-6 border-b border-zinc-800">
                                <h1 className="text-2xl font-bold">Financeiro</h1>
                            </div>
                            <nav className="flex-1 overflow-y-auto p-4 space-y-2">
                                {menus.map(t => (
                                    <button
                                        key={t}
                                        onClick={() => setTab(t)}
                                        className={`w-full text-left px-4 py-3 rounded-xl font-medium transition ${tab === t ? 'bg-blue-600 text-white' : 'text-zinc-400 hover:bg-zinc-800'}`}
                                    >
                                        {t === 'ia' ? 'IA/Dev' : t.charAt(0).toUpperCase() + t.slice(1)}
                                    </button>
                                ))}
                            </nav>
                        </aside>

                        <main className="flex-1 overflow-y-auto">
                            <header className="lg:hidden bg-zinc-900 p-4 flex justify-between items-center">
                                <h1 className="text-xl font-bold">Financeiro</h1>
                                <button onClick={() => setMenu(!menu)} className="p-2">☰</button>
                            </header>

                            {menu && (
                                <div className="lg:hidden fixed inset-0 z-50 bg-black bg-opacity-90" onClick={() => setMenu(false)}>
                                    <div className="w-64 h-full bg-zinc-900 p-4" onClick={e => e.stopPropagation()}>
                                        <nav className="space-y-2">
                                            {menus.map(t => (
                                                <button
                                                    key={t}
                                                    onClick={() => { setTab(t); setMenu(false); }}
                                                    className={`w-full text-left px-4 py-3 rounded-xl font-medium ${tab === t ? 'bg-blue-600' : 'text-zinc-400 hover:bg-zinc-800'}`}
                                                >
                                                    {t === 'ia' ? 'IA/Dev' : t.charAt(0).toUpperCase() + t.slice(1)}
                                                </button>
                                            ))}
                                        </nav>
                                    </div>
                                </div>
                            )}

                            <div className="p-4 sm:p-6 lg:p-8 max-w-7xl mx-auto">
                                {tab === 'dashboard' && (
                                    <div className="space-y-6">
                                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                                            <div className="bg-gradient-to-br from-green-600 to-green-700 p-5 sm:p-6 rounded-3xl">
                                                <h3 className="text-xs sm:text-sm mb-1 font-medium">Receitas</h3>
                                                <p className="text-3xl sm:text-4xl font-bold">{fmt(income)}</p>
                                            </div>
                                            <div className="bg-gradient-to-br from-red-600 to-red-700 p-5 sm:p-6 rounded-3xl">
                                                <h3 className="text-xs sm:text-sm mb-1 font-medium">Despesas</h3>
                                                <p className="text-3xl sm:text-4xl font-bold">{fmt(spent)}</p>
                                            </div>
                                            <div className="bg-gradient-to-br from-blue-600 to-blue-700 p-5 sm:p-6 rounded-3xl">
                                                <h3 className="text-xs sm:text-sm mb-1 font-medium">Saldo</h3>
                                                <p className="text-3xl sm:text-4xl font-bold">{fmt(balance)}</p>
                                            </div>
                                            <div className="bg-gradient-to-br from-purple-600 to-purple-700 p-5 sm:p-6 rounded-3xl">
                                                <h3 className="text-xs sm:text-sm mb-1 font-medium">Score</h3>
                                                <p className="text-3xl sm:text-4xl font-bold">90</p>
                                            </div>
                                        </div>

                                        <div className="card rounded-3xl p-5 sm:p-8">
                                            <h3 className="text-xl sm:text-2xl font-semibold mb-4 sm:mb-6">Patrimônio Líquido</h3>
                                            <p className="text-4xl sm:text-5xl lg:text-6xl font-bold text-blue-500 text-center mb-6 sm:mb-8">{fmt(netWorth)}</p>
                                            <div className="grid grid-cols-3 gap-3 sm:gap-6 text-center">
                                                <div>
                                                    <p className="text-zinc-400 text-xs sm:text-sm mb-1 sm:mb-2">Bens</p>
                                                    <p className="font-semibold text-base sm:text-xl lg:text-2xl text-green-500">{fmt(assetsTotal)}</p>
                                                </div>
                                                <div>
                                                    <p className="text-zinc-400 text-xs sm:text-sm mb-1 sm:mb-2">Investimentos</p>
                                                    <p className="font-semibold text-base sm:text-xl lg:text-2xl text-blue-500">{fmt(investTotal)}</p>
                                                </div>
                                                <div>
                                                    <p className="text-zinc-400 text-xs sm:text-sm mb-1 sm:mb-2">Dívidas</p>
                                                    <p className="font-semibold text-base sm:text-xl lg:text-2xl text-red-500">{fmt(debtsTotal)}</p>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="card rounded-3xl p-8">
                                            <h3 className="text-2xl font-semibold mb-6">Resumo Mensal</h3>
                                            <div className="space-y-4">
                                                <div className="flex justify-between"><span className="text-zinc-400">Gastos Variáveis</span><span className="font-semibold text-lg">{fmt(expTotal)}</span></div>
                                                <div className="flex justify-between"><span className="text-zinc-400">Assinaturas</span><span className="font-semibold text-lg">{fmt(subsTotal)}</span></div>
                                                <div className="flex justify-between"><span className="text-zinc-400">Contas Fixas</span><span className="font-semibold text-lg">{fmt(billsTotal)}</span></div>
                                                <div className="flex justify-between"><span className="text-zinc-400">Ferramentas IA/Dev</span><span className="font-semibold text-lg">{fmt(toolsTotal)}</span></div>
                                                <div className="border-t border-zinc-700 pt-4 flex justify-between">
                                                    <span className="font-bold text-lg">Total</span>
                                                    <span className="font-bold text-2xl">{fmt(spent)}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {tab === 'gastos' && (
                                    <div>
                                        <div className="mb-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                                            <div>
                                                <h2 className="text-2xl sm:text-3xl font-bold mb-2">Gastos</h2>
                                                <p className="text-sm sm:text-base text-zinc-400">Total: <span className="text-white font-semibold">{fmt(filtered.reduce((a, e) => a + e.valor, 0))}</span></p>
                                            </div>
                                            <select value={filter} onChange={e => setFilter(e.target.value)} className="input text-white px-4 py-3 rounded-xl w-full sm:w-auto">
                                                <option value="todos">Todos</option>
                                                {data.users.map(u => <option key={u.id} value={u.id}>{u.nome}</option>)}
                                            </select>
                                        </div>
                                        <button onClick={() => open('exp')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar</button>
                                        <div className="space-y-4">
                                            {filtered.map(e => (
                                                <div key={e.id} className="card p-4 sm:p-6 rounded-2xl flex flex-col sm:flex-row justify-between gap-4">
                                                    <div className="flex-1">
                                                        <h4 className="font-semibold text-lg sm:text-xl mb-2">{e.descricao}</h4>
                                                        <p className="text-xs sm:text-sm text-zinc-400">Por: {data.users.find(u => u.id === e.usuarioId)?.nome}</p>
                                                        <p className="text-xs sm:text-sm text-zinc-400">{new Date(e.data).toLocaleDateString('pt-BR')}</p>
                                                    </div>
                                                    <div className="flex justify-between sm:justify-end items-center gap-4">
                                                        <p className="text-2xl sm:text-3xl font-bold text-red-500">{fmt(e.valor)}</p>
                                                        <div className="flex sm:flex-col gap-3 sm:gap-2">
                                                            <button onClick={() => open('exp', e)} className="text-blue-500 text-sm">Editar</button>
                                                            <button onClick={() => del('exp', e.id)} className="text-red-500 text-sm">Remover</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {tab === 'assinaturas' && (
                                    <div>
                                        <div className="mb-6">
                                            <h2 className="text-2xl sm:text-3xl font-bold mb-2">Assinaturas</h2>
                                            <p className="text-sm sm:text-base text-zinc-400">Total: <span className="text-white font-semibold">{fmt(subsTotal)}</span></p>
                                        </div>
                                        <button onClick={() => open('sub')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar</button>
                                        <div className="space-y-4">
                                            {data.subs.map(s => (
                                                <div key={s.id} className="card p-4 sm:p-6 rounded-2xl flex flex-col sm:flex-row justify-between gap-4">
                                                    <div>
                                                        <h4 className="font-semibold text-lg sm:text-xl mb-2">{s.nome}</h4>
                                                        {s.ativa && <span className="text-xs bg-green-600 px-3 py-1.5 rounded-full">Ativa</span>}
                                                    </div>
                                                    <div className="flex justify-between sm:justify-end items-center gap-4">
                                                        <p className="text-2xl sm:text-3xl font-bold text-blue-500">{fmt(s.valor)}</p>
                                                        <div className="flex sm:flex-col gap-3 sm:gap-2">
                                                            <button onClick={() => open('sub', s)} className="text-blue-500 text-sm">Editar</button>
                                                            <button onClick={() => del('subs', s.id)} className="text-red-500 text-sm">Remover</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {tab === 'contas' && (
                                    <div>
                                        <div className="mb-6">
                                            <h2 className="text-2xl sm:text-3xl font-bold mb-2">Contas Fixas</h2>
                                            <p className="text-sm sm:text-base text-zinc-400">Total: <span className="text-white font-semibold">{fmt(billsTotal)}</span></p>
                                        </div>
                                        <button onClick={() => open('bill')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar</button>
                                        <div className="space-y-4">
                                            {data.bills.map(b => (
                                                <div key={b.id} className="card p-4 sm:p-6 rounded-2xl flex flex-col sm:flex-row justify-between gap-4">
                                                    <h4 className="font-semibold text-lg sm:text-xl">{b.nome}</h4>
                                                    <div className="flex justify-between sm:justify-end items-center gap-4">
                                                        <p className="text-2xl sm:text-3xl font-bold text-orange-500">{fmt(b.valor)}</p>
                                                        <div className="flex sm:flex-col gap-3 sm:gap-2">
                                                            <button onClick={() => open('bill', b)} className="text-blue-500 text-sm">Editar</button>
                                                            <button onClick={() => del('bills', b.id)} className="text-red-500 text-sm">Remover</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {tab === 'cartoes' && (
                                    <div>
                                        <h2 className="text-2xl sm:text-3xl font-bold mb-6">Cartões</h2>
                                        <button onClick={() => open('card')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar</button>
                                        <div className="space-y-4">
                                            {data.cards.map(c => {
                                                const p = (c.gasto / c.limite) * 100;
                                                const u = data.users.find(us => us.id === c.usuarioId);
                                                return (
                                                    <div key={c.id} className="card p-4 sm:p-6 rounded-2xl">
                                                        <div className="flex flex-col sm:flex-row justify-between gap-4 mb-4">
                                                            <div>
                                                                <h4 className="font-semibold text-lg sm:text-xl mb-2">{c.nome}</h4>
                                                                <p className="text-xs sm:text-sm text-zinc-400">Titular: {u?.nome}</p>
                                                            </div>
                                                            <div className="flex justify-between sm:justify-end items-center gap-4">
                                                                <div className="text-left sm:text-right">
                                                                    <p className="text-xl sm:text-2xl font-bold">{fmt(c.gasto)}</p>
                                                                    <p className="text-xs sm:text-sm text-zinc-400">de {fmt(c.limite)}</p>
                                                                </div>
                                                                <div className="flex sm:flex-col gap-3 sm:gap-2">
                                                                    <button onClick={() => open('card', c)} className="text-blue-500 text-sm">Editar</button>
                                                                    <button onClick={() => del('cards', c.id)} className="text-red-500 text-sm">Remover</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div className="w-full bg-zinc-800 rounded-full h-2">
                                                            <div className={`rounded-full h-2 ${p > 80 ? 'bg-red-500' : p > 50 ? 'bg-yellow-500' : 'bg-green-500'}`} style={{ width: `${p}%` }} />
                                                        </div>
                                                        <p className="text-xs sm:text-sm text-zinc-400 mt-2">{p.toFixed(1)}% utilizado</p>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}

                                {tab === 'metas' && (
                                    <div>
                                        <h2 className="text-3xl font-bold mb-6">Metas</h2>
                                        <button onClick={() => open('goal')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar</button>
                                        <div className="space-y-4">
                                            {data.goals.map(g => {
                                                const p = (g.valorAtual / g.valorAlvo) * 100;
                                                return (
                                                    <div key={g.id} className="card p-6 rounded-2xl">
                                                        <div className="flex justify-between mb-4">
                                                            <h4 className="font-semibold text-xl">{g.nome}</h4>
                                                            <div className="flex flex-col gap-2">
                                                                <button onClick={() => open('goal', g)} className="text-blue-500">Editar</button>
                                                                <button onClick={() => del('goals', g.id)} className="text-red-500">Remover</button>
                                                            </div>
                                                        </div>
                                                        <div className="w-full bg-zinc-800 rounded-full h-3 mb-3">
                                                            <div className="rounded-full h-3" style={{ width: `${p}%`, backgroundColor: g.cor }} />
                                                        </div>
                                                        <div className="flex justify-between text-sm text-zinc-400">
                                                            <span>{fmt(g.valorAtual)}</span>
                                                            <span>{p.toFixed(0)}%</span>
                                                            <span>{fmt(g.valorAlvo)}</span>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}

                                {tab === 'orcamentos' && (
                                    <div>
                                        <h2 className="text-3xl font-bold mb-6">Orçamentos</h2>
                                        <button onClick={() => open('budget')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar</button>
                                        <div className="space-y-4">
                                            {data.budgets.map(b => (
                                                <div key={b.id} className="card p-6 rounded-2xl flex justify-between">
                                                    <h4 className="font-semibold text-xl">{b.categoria}</h4>
                                                    <div className="flex gap-4">
                                                        <p className="text-3xl font-bold text-blue-500">{fmt(b.limite)}</p>
                                                        <div className="flex flex-col gap-2">
                                                            <button onClick={() => open('budget', b)} className="text-blue-500">Editar</button>
                                                            <button onClick={() => del('budgets', b.id)} className="text-red-500">Remover</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {tab === 'ia' && (
                                    <div>
                                        <div className="mb-6">
                                            <h2 className="text-2xl sm:text-3xl font-bold mb-2">Ferramentas IA/Dev</h2>
                                            <p className="text-sm sm:text-base text-zinc-400">Total: <span className="text-white font-semibold">{fmt(toolsTotal)}</span></p>
                                        </div>
                                        <button onClick={() => open('tool')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar Ferramenta</button>
                                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                                            {data.tools.map(t => (
                                                <div key={t.id} className={`card p-4 sm:p-6 rounded-2xl ${!t.ativa && 'opacity-50'}`}>
                                                    <div className="flex justify-between items-start mb-4">
                                                        <div className="flex-1">
                                                            <h4 className="font-semibold text-base sm:text-lg mb-1">{t.ferramenta}</h4>
                                                            <p className="text-xs text-zinc-400">Mensal</p>
                                                        </div>
                                                        <div className="flex gap-2">
                                                            <button onClick={() => open('tool', t)} className="text-blue-500 text-xs sm:text-sm">Editar</button>
                                                            <button onClick={() => del('tools', t.id)} className="text-red-500 text-xs sm:text-sm">Remover</button>
                                                        </div>
                                                    </div>
                                                    <p className="text-2xl sm:text-3xl font-bold text-purple-500 mb-4">{fmt(t.valor)}</p>
                                                    <button
                                                        onClick={() => setData({ ...data, tools: data.tools.map(tt => tt.id === t.id ? { ...tt, ativa: !tt.ativa } : tt) })}
                                                        className={`text-xs px-4 py-2 rounded-full font-medium ${t.ativa ? 'bg-green-600' : 'bg-zinc-700'}`}
                                                    >
                                                        {t.ativa ? 'Ativa' : 'Inativa'}
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {tab === 'investimentos' && (
                                    <div>
                                        <div className="mb-6">
                                            <h2 className="text-3xl font-bold mb-2">Investimentos</h2>
                                            <p className="text-zinc-400">Total: <span className="text-white font-semibold">{fmt(investTotal)}</span></p>
                                        </div>
                                        <button onClick={() => open('invest')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar</button>
                                        <div className="space-y-4">
                                            {data.investments.map(i => (
                                                <div key={i.id} className="card p-6 rounded-2xl flex justify-between">
                                                    <div>
                                                        <h4 className="font-semibold text-xl mb-2">{i.nome}</h4>
                                                        <p className="text-sm text-zinc-400">{i.tipo}</p>
                                                        <p className="text-sm text-green-500">Rendimento: {i.rendimento}%</p>
                                                    </div>
                                                    <div className="flex gap-4">
                                                        <p className="text-3xl font-bold text-green-500">{fmt(i.valor)}</p>
                                                        <div className="flex flex-col gap-2">
                                                            <button onClick={() => open('invest', i)} className="text-blue-500">Editar</button>
                                                            <button onClick={() => del('investments', i.id)} className="text-red-500">Remover</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {tab === 'patrimonio' && (
                                    <div>
                                        <div className="mb-6">
                                            <h2 className="text-3xl font-bold mb-2">Patrimônio</h2>
                                            <p className="text-zinc-400">Total: <span className="text-white font-semibold">{fmt(assetsTotal)}</span></p>
                                        </div>
                                        <button onClick={() => open('asset')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar</button>
                                        <div className="space-y-4">
                                            {data.assets.map(a => (
                                                <div key={a.id} className="card p-6 rounded-2xl flex justify-between">
                                                    <div>
                                                        <h4 className="font-semibold text-xl mb-2">{a.nome}</h4>
                                                        <p className="text-sm text-zinc-400">{a.tipo}</p>
                                                    </div>
                                                    <div className="flex gap-4">
                                                        <p className="text-3xl font-bold text-blue-500">{fmt(a.valor)}</p>
                                                        <div className="flex flex-col gap-2">
                                                            <button onClick={() => open('asset', a)} className="text-blue-500">Editar</button>
                                                            <button onClick={() => del('assets', a.id)} className="text-red-500">Remover</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {tab === 'dividas' && (
                                    <div>
                                        <div className="mb-6">
                                            <h2 className="text-3xl font-bold mb-2">Dívidas</h2>
                                            <p className="text-zinc-400">Restante: <span className="text-white font-semibold">{fmt(debtsTotal)}</span></p>
                                        </div>
                                        <button onClick={() => open('debt')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar</button>
                                        <div className="space-y-4">
                                            {data.debts.map(d => {
                                                const p = (d.valorPago / d.valorTotal) * 100;
                                                return (
                                                    <div key={d.id} className="card p-6 rounded-2xl">
                                                        <div className="flex justify-between mb-4">
                                                            <div>
                                                                <h4 className="font-semibold text-xl mb-2">{d.nome}</h4>
                                                                <p className="text-sm text-zinc-400">Parcela {d.parcelasPagas} de {d.parcelas}</p>
                                                            </div>
                                                            <div className="flex gap-4">
                                                                <div className="text-right">
                                                                    <p className="text-2xl font-bold text-red-500">{fmt(d.valorTotal - d.valorPago)}</p>
                                                                    <p className="text-sm text-zinc-400">restante</p>
                                                                </div>
                                                                <div className="flex flex-col gap-2">
                                                                    <button onClick={() => open('debt', d)} className="text-blue-500">Editar</button>
                                                                    <button onClick={() => del('debts', d.id)} className="text-red-500">Remover</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div className="w-full bg-zinc-800 rounded-full h-2">
                                                            <div className="bg-green-500 rounded-full h-2" style={{ width: `${p}%` }} />
                                                        </div>
                                                        <p className="text-sm text-zinc-400 mt-2">{p.toFixed(1)}% pago</p>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}

                                {tab === 'emprestimos' && (
                                    <div>
                                        <h2 className="text-3xl font-bold mb-6">Empréstimos</h2>
                                        <button onClick={() => open('loan')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar</button>
                                        <div className="space-y-4">
                                            {data.loans.map(l => (
                                                <div key={l.id} className="card p-6 rounded-2xl flex justify-between">
                                                    <div>
                                                        <h4 className="font-semibold text-xl mb-2">{l.nome}</h4>
                                                        <p className="text-sm text-zinc-400">{l.tipo === 'emprestei' ? 'Você emprestou' : 'Você pegou'}</p>
                                                        <p className="text-sm text-zinc-400">{new Date(l.data).toLocaleDateString('pt-BR')}</p>
                                                        {l.pago && <span className="text-xs bg-green-600 px-3 py-1.5 rounded-full mt-2 inline-block">Pago</span>}
                                                    </div>
                                                    <div className="flex gap-4">
                                                        <p className={`text-3xl font-bold ${l.tipo === 'emprestei' ? 'text-green-500' : 'text-red-500'}`}>{fmt(l.valor)}</p>
                                                        <div className="flex flex-col gap-2">
                                                            <button onClick={() => open('loan', l)} className="text-blue-500">Editar</button>
                                                            <button onClick={() => del('loans', l.id)} className="text-red-500">Remover</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {tab === 'usuarios' && (
                                    <div>
                                        <h2 className="text-3xl font-bold mb-6">Usuários</h2>
                                        <button onClick={() => open('user')} className="w-full btn text-white px-6 py-4 rounded-xl font-semibold mb-6">+ Adicionar</button>
                                        <div className="space-y-4">
                                            {data.users.map(u => {
                                                const sal = data.salaries.find(s => s.usuarioId === u.id);
                                                const userExp = data.exp.filter(e => e.usuarioId === u.id).reduce((a, e) => a + e.valor, 0);
                                                return (
                                                    <div key={u.id} className="card p-6 rounded-2xl">
                                                        <div className="flex gap-4 mb-4">
                                                            <div className="w-16 h-16 rounded-full" style={{ backgroundColor: u.cor }} />
                                                            <div className="flex-1">
                                                                <h4 className="font-semibold text-xl mb-2">{u.nome}</h4>
                                                                <button onClick={() => open('salary', sal || { usuarioId: u.id })} className="text-sm text-blue-500">
                                                                    {sal ? 'Editar' : 'Adicionar'} salário
                                                                </button>
                                                            </div>
                                                            <div className="flex flex-col gap-2">
                                                                <button onClick={() => open('user', u)} className="text-blue-500">Editar</button>
                                                                <button onClick={() => del('users', u.id)} className="text-red-500">Remover</button>
                                                            </div>
                                                        </div>
                                                        <div className="grid grid-cols-2 gap-4">
                                                            <div>
                                                                <p className="text-sm text-zinc-400 mb-1">Salário</p>
                                                                <p className="font-semibold text-lg text-green-500">{fmt(sal?.valor || 0)}</p>
                                                            </div>
                                                            <div>
                                                                <p className="text-sm text-zinc-400 mb-1">Gastos</p>
                                                                <p className="font-semibold text-lg text-red-500">{fmt(userExp)}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}

                                {modal && (
                                    <div className="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4 z-50 backdrop-blur-sm">
                                        <div className="card rounded-3xl p-6 max-w-md w-full max-h-[90vh] overflow-y-auto">
                                            <h3 className="text-2xl font-semibold mb-6">{editing ? 'Editar' : 'Adicionar'}</h3>
                                            <div className="space-y-4">
                                                {modal === 'exp' && (
                                                    <>
                                                        <input type="text" placeholder="Descrição" value={form.descricao || ''} onChange={e => setForm({ ...form, descricao: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Valor" value={form.valor || ''} onChange={e => setForm({ ...form, valor: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <select value={form.usuarioId || 1} onChange={e => setForm({ ...form, usuarioId: parseInt(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl">
                                                            {data.users.map(u => <option key={u.id} value={u.id}>{u.nome}</option>)}
                                                        </select>
                                                        <input type="date" value={form.data || ''} onChange={e => setForm({ ...form, data: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                    </>
                                                )}
                                                {modal === 'sub' && (
                                                    <>
                                                        <input type="text" placeholder="Nome" value={form.nome || ''} onChange={e => setForm({ ...form, nome: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Valor" value={form.valor || ''} onChange={e => setForm({ ...form, valor: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <div className="flex items-center gap-3">
                                                            <input type="checkbox" checked={form.ativa !== false} onChange={e => setForm({ ...form, ativa: e.target.checked })} className="w-5 h-5" />
                                                            <label>Ativa</label>
                                                        </div>
                                                    </>
                                                )}
                                                {modal === 'bill' && (
                                                    <>
                                                        <input type="text" placeholder="Nome" value={form.nome || ''} onChange={e => setForm({ ...form, nome: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Valor" value={form.valor || ''} onChange={e => setForm({ ...form, valor: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                    </>
                                                )}
                                                {modal === 'card' && (
                                                    <>
                                                        <input type="text" placeholder="Nome" value={form.nome || ''} onChange={e => setForm({ ...form, nome: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Limite" value={form.limite || ''} onChange={e => setForm({ ...form, limite: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Gasto" value={form.gasto || ''} onChange={e => setForm({ ...form, gasto: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <select value={form.usuarioId || 1} onChange={e => setForm({ ...form, usuarioId: parseInt(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl">
                                                            {data.users.map(u => <option key={u.id} value={u.id}>{u.nome}</option>)}
                                                        </select>
                                                    </>
                                                )}
                                                {modal === 'goal' && (
                                                    <>
                                                        <input type="text" placeholder="Nome" value={form.nome || ''} onChange={e => setForm({ ...form, nome: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Valor Alvo" value={form.valorAlvo || ''} onChange={e => setForm({ ...form, valorAlvo: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Valor Atual" value={form.valorAtual || ''} onChange={e => setForm({ ...form, valorAtual: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="color" value={form.cor || '#007AFF'} onChange={e => setForm({ ...form, cor: e.target.value })} className="w-full h-12 rounded-xl" />
                                                    </>
                                                )}
                                                {modal === 'budget' && (
                                                    <>
                                                        <input type="text" placeholder="Categoria" value={form.categoria || ''} onChange={e => setForm({ ...form, categoria: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Limite" value={form.limite || ''} onChange={e => setForm({ ...form, limite: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                    </>
                                                )}
                                                {modal === 'invest' && (
                                                    <>
                                                        <input type="text" placeholder="Nome" value={form.nome || ''} onChange={e => setForm({ ...form, nome: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Valor" value={form.valor || ''} onChange={e => setForm({ ...form, valor: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="text" placeholder="Tipo" value={form.tipo || ''} onChange={e => setForm({ ...form, tipo: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Rendimento" value={form.rendimento || ''} onChange={e => setForm({ ...form, rendimento: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                    </>
                                                )}
                                                {modal === 'asset' && (
                                                    <>
                                                        <input type="text" placeholder="Nome" value={form.nome || ''} onChange={e => setForm({ ...form, nome: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Valor" value={form.valor || ''} onChange={e => setForm({ ...form, valor: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="text" placeholder="Tipo" value={form.tipo || ''} onChange={e => setForm({ ...form, tipo: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                    </>
                                                )}
                                                {modal === 'debt' && (
                                                    <>
                                                        <input type="text" placeholder="Nome" value={form.nome || ''} onChange={e => setForm({ ...form, nome: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Valor Total" value={form.valorTotal || ''} onChange={e => setForm({ ...form, valorTotal: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Valor Pago" value={form.valorPago || ''} onChange={e => setForm({ ...form, valorPago: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Parcelas" value={form.parcelas || ''} onChange={e => setForm({ ...form, parcelas: parseInt(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Parcelas Pagas" value={form.parcelasPagas || ''} onChange={e => setForm({ ...form, parcelasPagas: parseInt(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                    </>
                                                )}
                                                {modal === 'loan' && (
                                                    <>
                                                        <input type="text" placeholder="Nome" value={form.nome || ''} onChange={e => setForm({ ...form, nome: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Valor" value={form.valor || ''} onChange={e => setForm({ ...form, valor: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <select value={form.tipo || 'emprestei'} onChange={e => setForm({ ...form, tipo: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl">
                                                            <option value="emprestei">Emprestei</option>
                                                            <option value="peguei">Peguei</option>
                                                        </select>
                                                        <input type="date" value={form.data || ''} onChange={e => setForm({ ...form, data: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <div className="flex items-center gap-3">
                                                            <input type="checkbox" checked={form.pago || false} onChange={e => setForm({ ...form, pago: e.target.checked })} className="w-5 h-5" />
                                                            <label>Pago</label>
                                                        </div>
                                                    </>
                                                )}
                                                {modal === 'tool' && (
                                                    <>
                                                        <input type="text" placeholder="Ferramenta" value={form.ferramenta || ''} onChange={e => setForm({ ...form, ferramenta: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="number" placeholder="Valor" value={form.valor || ''} onChange={e => setForm({ ...form, valor: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <div className="flex items-center gap-3">
                                                            <input type="checkbox" checked={form.ativa !== false} onChange={e => setForm({ ...form, ativa: e.target.checked })} className="w-5 h-5" />
                                                            <label>Ativa</label>
                                                        </div>
                                                    </>
                                                )}
                                                {modal === 'user' && (
                                                    <>
                                                        <input type="text" placeholder="Nome" value={form.nome || ''} onChange={e => setForm({ ...form, nome: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="color" value={form.cor || '#007AFF'} onChange={e => setForm({ ...form, cor: e.target.value })} className="w-full h-12 rounded-xl" />
                                                    </>
                                                )}
                                                {modal === 'salary' && (
                                                    <>
                                                        <select value={form.usuarioId || 1} onChange={e => setForm({ ...form, usuarioId: parseInt(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl">
                                                            {data.users.map(u => <option key={u.id} value={u.id}>{u.nome}</option>)}
                                                        </select>
                                                        <input type="number" placeholder="Valor" value={form.valor || ''} onChange={e => setForm({ ...form, valor: parseFloat(e.target.value) })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                        <input type="text" placeholder="Descrição" value={form.descricao || ''} onChange={e => setForm({ ...form, descricao: e.target.value })} className="w-full input text-white px-4 py-3 rounded-xl" />
                                                    </>
                                                )}
                                                <div className="flex gap-3 pt-2">
                                                    <button onClick={save} className="flex-1 btn text-white py-3 rounded-xl font-semibold">Salvar</button>
                                                    <button onClick={close} className="flex-1 bg-zinc-700 text-white py-3 rounded-xl font-semibold">Cancelar</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </main>
                    </div>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
